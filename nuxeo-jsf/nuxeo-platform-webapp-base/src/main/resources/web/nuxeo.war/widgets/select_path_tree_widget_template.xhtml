<ui:composition
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:nxu="http://nuxeo.org/nxweb/util"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:c="http://java.sun.com/jstl/core"
  xmlns:nxd="http://nuxeo.org/nxweb/document"
  xmlns:nxl="http://nuxeo.org/nxforms/layout"
  xmlns:a4j="http://richfaces.org/a4j">
<div id="#{widget.id}">

<c:if test="#{widget.mode != 'create' and widget.mode != 'edit'}">

  <h:dataTable value="#{field_0}" var="path"
    rendered="#{not empty field_0}">
    <h:column>
      <h:outputText value="#{nxd:titleOrId(treeWidgetActions.getDocumentFromPath(path))}" />
    </h:column>
  </h:dataTable>

</c:if>

<c:if test="#{widget.mode == 'create' or widget.mode == 'edit'}">

  <a4j:outputPanel id="#{widget.id}_listRegion" ajaxRendered="true"
    layout="block">
    <div class="clear">
      <nxu:inputList id="#{widget.id}_list" value="#{field_0}"
        model="model" required="#{widgetProperty_required}">
        <span class="sticker">
          <label>
            <h:outputText value="#{nxd:titleOrId(treeWidgetActions.getDocumentFromPath(model.rowData))}" />
          </label>
          <h:commandLink immediate="true"
            actionListener="#{editableListBean.performAction}"
            id="#{widget.id}_delete" render="#{widget.id}_listRegion"
            bypassUpdates="true">
            <img src="#{contextPath}/icons/delete.png" alt="Delete" />
            <f:param name="for" value="#{widget.id}_list" />
            <f:param name="index" value="#{model.rowIndex}" />
            <f:param name="type" value="remove" />
            <f:ajax execute="@form" render="#{widget.id}_listRegion" />
          </h:commandLink>
        </span>
      </nxu:inputList>
      <h:message styleClass="errorMessage" for="#{widget.id}_list"
        id="#{widget.id}_list_message" />
    </div>
  </a4j:outputPanel>

  <nxu:set var="ecmPathWidgetId" value="#{widget.id}">
  <nxu:set var="showAllDomains" value="#{widget.properties.showAllDomains}">
    <nxl:widget name="select_path_tree_fancybox"
      mode="#{widget.mode}" />
  </nxu:set>
  </nxu:set>

</c:if>

</div>
</ui:composition>